<!DOCTYPE html>
<!--[if lt IE 7 ]> <html dir="ltr" lang="it-IT" class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <html dir="ltr" lang="it-IT" class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <html dir="ltr" lang="it-IT" class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <html dir="ltr" lang="it-IT" class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html dir="ltr" lang="it-IT"> <!--<![endif]-->

<head>
<title>Muoversi in Piemonte</title>

<!--  Mobile Viewport Fix -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!--  Let the poor EI behave decently -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">

<link rel="stylesheet" href="js/lib/jquery-ui/css/smoothness/jquery-ui-1.9.1.custom.css" />
<link rel="stylesheet" href="js/lib/jquery-ui/addons/jquery-ui-timepicker.css" />
<link rel="stylesheet" href="https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.css" />
<link rel="stylesheet" href="js/otp/widgets/widget-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/planner/planner-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/bikeshare/bikeshare-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/multimodal/multimodal-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/calltaker/calltaker-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/analyst/analyst-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/alerts/alerts-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/alerts/alerts-style.css?v=1" />
<link rel="stylesheet" href="js/otp/modules/fieldtrip/fieldtrip-style.css?v=1" />
<link rel="stylesheet" href="js/otp/widgets/tripoptions/tripoptions-style.css?v=1" />
<link rel="stylesheet" href="js/otp/widgets/transit/widgets-transit-style.css?v=1" />
<link rel="stylesheet" href="js/lib/magnific-popup.css" />
<link rel="stylesheet" href="style.css?v=1" />
<link rel="stylesheet" href="style-5t.css?v=1" />
<link rel="stylesheet" href="style-5t-mqueries.css?v=1" />

<!--Loads jquery, underscore,  json2, momentjs and raphael makes 7 requests less-->
<script src="//cdn.jsdelivr.net/g/jquery@1.9.1,underscorejs@1.4.2,json2@0.1,momentjs@2.11.1,raphael@2.1.2,i18next@1.7.7"></script>
<script src='https://api.mapbox.com/mapbox.js/v2.3.0/mapbox.js'></script>
<!-- jquery-ui -->
<script src="js/lib/jquery-ui/js/jquery-ui-1.9.1.custom.min.js"></script>
<script src="js/lib/jquery-ui/addons/jquery-ui-timepicker.js"></script>

<script src="./js/lib/jquery-ui/i18n/jquery.ui.datepicker-it.js"></script>

<!-- Magnific PopUp -->
<script src="js/lib/jquery.magnific-popup.js"></script>

<!-- backbone -->
<script src="js/lib/backbone.js"></script>

<!-- Mustache/ICanHaz -->
<script src="//cdn.jsdelivr.net/mustache.js/0.7.2/mustache.js"></script>
<script src="js/lib/ICanHaz.js"></script>
<!-- moment-duration-format --> 
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment-duration-format/1.3.0/moment-duration-format.min.js"></script>


<!-- otp-specific imports -->
<script src="js/otp/otp.js?v=1"></script>

<!-- otp-locales -->
<script src="js/otp/locale/English.js?v=1"></script>
<script src="js/otp/locale/Italian.js?v=1"></script>
<script src="js/otp/locale/Catalan.js?v=1"></script>
<script src="js/otp/locale/Polish.js?v=1"></script>

<script src="js/otp/config.js?v=1"></script>

<!--<script src="js/otp/debug.js?v=1"></script>-->
<script src="js/otp/templates.js?v=1"></script>


<script src="js/otp/util/Geo.js?v=1"></script>
<script src="js/otp/util/Itin.js?v=1"></script>
<script src="js/otp/util/Logger.js?v=1"></script>
<script src="js/otp/util/Text.js?v=1"></script>
<script src="js/otp/util/Time.js?v=1"></script>
<script src="js/otp/util/Imperial.js?v=1"></script>

<script src="js/otp/core/Webapp.js?v=1"></script>
<script src="js/otp/core/Map.js?v=1"></script>
<script src="js/otp/core/QueryLogger.js?v=1"></script>
<script src="js/otp/core/PopupMenu.js?v=1"></script>
<script src="js/otp/core/ContextMenu.js?v=1"></script>
<script src="js/otp/core/MapContextMenu.js?v=1"></script>
<script src="js/otp/core/WidgetManagerMenu.js?v=1"></script>
<script src="js/otp/core/Geocoder.js?v=1"></script>
<script src="js/otp/core/GeocoderBuiltin.js?v=1"></script>
<script src="js/otp/core/GeocoderBag.js?v=1"></script>
<script src="js/otp/core/GeocoderYp.js?v=1"></script>
<script src="js/otp/core/GeocoderPelias.js?v=1"></script>
<script src="js/otp/core/SOLRGeocoder.js?v=1"></script>
<script src="js/otp/core/TransitIndex.js?v=1"></script>
<script src="js/otp/core/IndexApi.js?v=1"></script>
<script src="js/otp/core/TrinetSessionManager.js?v=1"></script>
<script src="js/otp/core/DefaultSessionManager.js?v=1"></script>

<script src="js/otp/widgets/Widget.js?v=1"></script>
<script src="js/otp/widgets/WidgetManager.js?v=1"></script>
<script src="js/otp/widgets/Dialogs.js?v=1"></script>

<script src="js/otp/modules/Module.js?v=1"></script>

<script src="js/otp/modules/planner/PlannerModule.js?v=1"></script>
<script src="js/otp/modules/planner/IconFactory.js?v=1"></script>
<script src="js/otp/modules/planner/TripPlan.js?v=1"></script>
<script src="js/otp/modules/planner/Itinerary.js?v=1"></script>
<script src="js/otp/modules/planner/ItinerariesWidget.js?v=1"></script>

<script src="js/otp/modules/multimodal/MultimodalPlannerModule.js?v=1"></script>

<script src="js/otp/modules/datex/EventModule.js?v=1"></script>
<script src="js/otp/modules/datex/EventCategoryWidget.js?v=1"></script>

<script src="js/otp/modules/bikeshare/BikeShareModule.js?v=1"></script>
<!--Loads some javascript modules only if they are enabled in config.js-->
<script type="text/javascript">
	//Which modules needs which files
	var modules = {
		'otp.modules.bikeshare.BikeShareModule':
			[
			'js/otp/modules/bikeshare/BikeStationsWidget.js?v=1'
		],
		'otp.modules.analyst.AnalystModule':
			[
			'js/otp/modules/analyst/AnalystModule.js?v=1',
			'js/otp/modules/analyst/AnalystLegendWidget.js?v=1',
		],
		'otp.modules.calltaker.CallTakerModule':
			[
			'js/lib/jspdf.min.js',
			'js/otp/modules/calltaker/CallTakerModule.js?v=1',
			'js/otp/modules/calltaker/CallHistoryWidget.js?v=1',
			'js/otp/modules/calltaker/MailablesWidget.js?v=1',
			'js/otp/modules/calltaker/calltaker-models.js?v=1',
			],
		'otp.modules.annotations.AnnotationsModule':
			[
			'js/otp/modules/annotations/AnnotationsModule.js?v=1'
		],
		'otp.modules.alerts.AlertsModule':
			[
			'js/otp/modules/alerts/AlertsModule.js?v=1',
			'js/otp/modules/alerts/AlertsWidget.js?v=1',
			'js/otp/modules/alerts/EntitiesWidget.js?v=1',
			'js/otp/modules/alerts/alerts-models.js?v=1',
		],
		'otp.modules.fieldtrip.FieldTripModule':
			[
			'js/otp/modules/fieldtrip/FieldTripModule.js?v=1',
			'js/otp/modules/fieldtrip/FieldTripManagerWidget.js?v=1',
			'js/otp/modules/fieldtrip/FieldTripRequestWidget.js?v=1',
			'js/otp/modules/fieldtrip/FieldTripGeocoderWidget.js?v=1',
			'js/otp/modules/fieldtrip/SaveFieldTripWidget.js?v=1',
			'js/otp/modules/fieldtrip/SearchWidget.js?v=1'
			]

	}
	for (var moduleIndex = 0; moduleIndex < otp.config.modules.length; moduleIndex++) {
		var curModuleClass = otp.config.modules[moduleIndex]["className"]
		//console.log(curModuleClass);
		if (curModuleClass in modules) {
			var modulesScripts = modules[curModuleClass];
			for (var scriptIndex = 0; scriptIndex < modulesScripts.length; scriptIndex++) {
				$.ajax({
					url: modulesScripts[scriptIndex],
					dataType: "script",
					cache: true,
					async: false
				})
				.fail(function(jqxhr, settings, exception) {
					console.error(settings);
					console.error(jqxhr.error());
					console.error(exception);
				});
			}
		}
	}

</script>



<script src="js/otp/widgets/InfoWidget.js?v=1"></script>
<script src="js/otp/widgets/tripoptions/RoutesSelectorWidget.js?v=1"></script>
<script src="js/otp/widgets/tripoptions/TripOptionsWidget.js?v=1"></script>
<script src="js/otp/widgets/tripoptions/BikeTrianglePanel.js?v=1"></script>

<script src="js/otp/widgets/transit/RouteBasedWidget.js?v=1"></script>
<script src="js/otp/widgets/transit/StopViewerWidget.js?v=1"></script>
<script src="js/otp/widgets/transit/StopFinderWidget.js?v=1"></script>
<script src="js/otp/widgets/transit/TripViewerWidget.js?v=1"></script>

<script src="js/otp/layers/StopsLayer.js?v=1"></script>

<!-- make legacy Internet Explorer play nice(r) -->
<!--[if lt IE 9]>
  <script src="//cdn.jsdelivr.net/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="//cdn.jsdelivr.net/respond/0.1/respond.min.js"></script>
<![endif]-->


<!-- load ICH templates and create the webapp at startup -->
<script type="text/javascript" language="javascript">


function setHeight(){
        var windowHeight = $(window).height();
        var headerHeight = $('#branding').outerHeight();
        var tabsHeight = $('#sidebar .tabs').outerHeight();
        var topHeight = $('#sidebar #tab1 .top').outerHeight();

        if($(".tabs li.traffic").hasClass('active')){
            topHeight = $('#sidebar #tab2 .top').outerHeight();
        }

        var height = windowHeight-(tabsHeight+topHeight+headerHeight);
        
        console.log( '///////////////////////' );
        console.log( windowHeight );
        console.log( tabsHeight);
        console.log( topHeight);
        console.log( headerHeight);

        $('.sidebar-scroll').height(height);

}

$(document).ready(function() {


	$('.panel-trigger').click(function(){
		$(this).toggleClass('closed');
		$('#sidebar').toggleClass('closed');
		$('#map').toggleClass('open');
		if(!$('.mapoverlay').hasClass('closed')){
			$('.mapoverlay').hide().toggleClass('closed');
		} else if( $('body').width() < 401 && $('.mapoverlay').hasClass('closed')){
			$('.mapoverlay').show().toggleClass('closed');
		}
		setTimeout(function(){webapp.map.lmap.invalidateSize()}, 400);	
	});

	$('.mapoverlay').click(function(){
		$(this).hide().toggleClass('closed');
		$('.panel-trigger').toggleClass('closed');
		$('#sidebar').toggleClass('closed');
		$('#map').toggleClass('open');
	});

	function resizeEndActions(){
		if($('body').width() > 400 || $('#sidebar').hasClass('closed')){
			$('.mapoverlay').hide().addClass('closed');
		} else {
			$('.mapoverlay').show().removeClass('closed');
		}
		if($('body').width() > 960 && $('#branding').hasClass('full-height')) {
			$('#nav-toggle').click();
		}
		
		setTimeout(function(){
			setHeight();
		}, 1000);
	}

	resizeEndActions();

	$(window).resize(function() {
		clearTimeout(window.resizedFinished);
		window.resizedFinished = setTimeout(function(){
			resizeEndActions();
		}, 250);
	});


	//Sets datepicker language based on selected/detected language in config.js
	$.datepicker.setDefaults($.datepicker.regional[otp.config.locale.config.datepicker_locale_short]);
    var templateUrls = [ //new Array(
        'js/otp/layers/layers-templates.html',
        'js/otp/widgets/widget-templates.html',
        'js/otp/widgets/tripoptions/tripoptions-templates.html',
        'js/otp/widgets/transit/widgets-transit-templates.html',
		'js/otp/widgets/infowidget-templates.html',
    ];

    var loadedTemplates = 0;
	var webapp = null;

    for(var i = 0; i < templateUrls.length; i++) {
        $.get(templateUrls[i])
        .success(function(html) {
            $('<div style="display:none;"></div>').appendTo($("body")).html(html);
            loadedTemplates++;
            if(loadedTemplates == templateUrls.length) {
                ich.grabTemplates();
                webapp = new otp.core.Webapp();
            }
        });
    }
		
	// Init nav toggle		
	$( "#nav-toggle" ).click(function() {
		$( ".main-menu-5t" ).toggleClass("active");
		$( ".language-switcher" ).toggleClass("active");
		$( this ).toggleClass("active");
		$( "#branding" ).toggleClass("full-height");
	});
	


	// ---- Tabs ----------------------------------------------------------------------------------------------------------

	$("ul.tabs").html('<li class="planner left active"><a data-tab="tab1" href="#planner">'+ _tr("Route_planner")+'</a></li>\
	                   <li class="traffic right">      <a data-tab="tab2" href="#traffic">' +_tr("Traffic_info") +'</a></li>');
	$("ul#main-menu-5t li").click(function() { 
		if($(this).index() == 1 || $(this).index() == 2){
			//webapp.setActiveModule(webapp.modules[$(this).index()+1]);
			$(this).siblings().removeClass("active");
			$(this).addClass("active"); 

		}
		
	});

	$('.modalbox').magnificPopup({
		type:'inline',
		overflowY: 'scroll',
		midClick: true // Allow opening popup on middle mouse click. Always set it to true if you don't provide alternative source in href.
	});

});

</script>

</head>
<body class="js-media-query-tester">

<header id="branding" role="banner" class="clearfix">

	<hgroup id="logo">
		<h1 id="site-title">Muoversi in Piemonte</h1>
	</hgroup>  
 
	<nav id="main-menu-container" class="main-menu-container">
		<div id="language-switcher" class="language-switcher"></div>
		<div class="shader"></div>
		<a id="nav-toggle" href="javascript:void(0)"><span></span></a>
	</nav>

</header>

<div id="sidebar" class="tabbed-content">

    <ul class="tabs"></ul>

    <div class="tab-container">

        <div id="tab1" class="tab-content planner active">
        	<div class="top">
            </div> 
          	<div class="sidebar-scroll">
	        	<div class="main">
	        	</div>
        	</div>
        </div>
        <div id="tab2" class="tab-content traffic">
      		<div class="top">
        	</div>
        	<div class="sidebar-scroll">
	        	<div class="main">
					<div class="infosCtnr"></div>
					<div class="eventsCtnr"></div>
	        	</div>
        	</div>
        </div>
    </div>

	<span class="panel-trigger fonticon"></span>

</div>  


<div id="map">
	<a class="powered-by" href="http://www.5t.torino.it">Powered by 5T</a>
	<div class="legend">
		<h2>Traffico</h2>
		<ul>
			<li class="green">Regolare</li>
			<li class="yellow">Rallentamenti</li>
			<li class="orange">Intenso</li>
			<li class="red">Code</li>
		</ul>	
	</div>
</div>
<div class="mapoverlay"></div>

<div id="otp-spinner"><img src="images/spinner.gif"></div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('set', 'anonymizeIp', true);
  ga('create', 'UA-4633264-9', 'auto');
  ga('send', 'pageview');
</script>

</body>
</html>
